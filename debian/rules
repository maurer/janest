#!/usr/bin/make -f
DEST_DIR = $(CURDIR)/debian/tmp
DOC_PKG = libcore-ocaml-doc
DEV_PKG = libcore-ocaml-dev
EXT_PKG = libcore-extended-ocaml-dev

# Ensure -dev packages are installed when dh_ocamldoc is invoked on the -doc
# package.  Rationale: to avoid "dup interface" errors we should invoke
# ocamldoc on the actually installed .mli-s (and not on lib/,extended/). The
# dep should be binary to install (instead of build to install) to ensure when
# arch packages are installed we are under fakeroot.
binary/$(DOC_PKG):: install-arch common-binary-post-install-arch

include /usr/share/cdbs/1/rules/patchsys-quilt.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/makefile.mk
include /usr/share/cdbs/1/rules/ocaml.mk

ifeq ($(OCAML_HAVE_OCAMLOPT),yes)
DEB_MAKE_BUILD_TARGET = all
DEB_MAKE_INSTALL_TARGET = install DESTDIR=$(DEST_DIR) OCAMLFIND_INSTFLAGS="-destdir $(DEST_DIR) -ldconf ignore"
else
DEB_MAKE_BUILD_TARGET = byte
DEB_MAKE_INSTALL_TARGET = libinstall-byte-code DESTDIR=$(DEST_DIR) OCAMLFIND_INSTFLAGS="-destdir $(DEST_DIR) -ldconf ignore"
endif
