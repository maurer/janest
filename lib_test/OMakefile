OCAML_LIBRARIES = core core_extended oUnit qtest_lib

switch $(OS)
case Darwin
  DEBUG_CFLAGS = \
    -pipe -g -fPIC -DPIC -O0 -Wall -pedantic -Wextra \
    -Wunused -Wno-long-long -DCAML_NAME_SPACE
  OPT_CFLAGS = $(DEBUG_CFLAGS) -O2 -fomit-frame-pointer
  CFLAGS=$(OPT_CFLAGS)
  CXXFLAGS = $(CFLAGS)
  export


TARGETS = test_runner.exe ktee.exe qtest.exe
FOO =
OCamlPreprocess($(PA_CPP), test bigstring_test)
OCamlMakePPDeps($(PA_BIN_PROT), core_set_test)

OCamlMakeProjDefaults($(TARGETS))
OCamlTop(mycaml,$(FOO))

local_runtest: $(TARGETS)
        ./test_runner.exe

.PHONY: test_mycaml
test_mycaml: mycaml
  $(BIN)/test-mycaml.sh

runtest: $(TARGETS) test_mycaml
        ./test_runner.exe

qtest: qtest.exe
        ./qtest.exe

InstantiateOCamlEnv()
